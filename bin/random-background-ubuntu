#!/bin/bash -l

# https://askubuntu.com/questions/140305/cron-not-able-to-succesfully-change-background

user=$(whoami)

fl=$(find /proc -maxdepth 2 -user "$user" -name environ -print -quit)
while [ -z $(grep -z DBUS_SESSION_BUS_ADDRESS "$fl" | cut -d= -f2- | tr -d '\000' ) ]
do
  fl=$(find /proc -maxdepth 2 -user "$user" -name environ -newer "$fl" -print -quit)
done

export DBUS_SESSION_BUS_ADDRESS=$(grep -z DBUS_SESSION_BUS_ADDRESS "$fl" | cut -d= -f2-)

img=$(random_file "$WALLPAPERS")

background_set_ubuntu "$img"

echo "$img"
