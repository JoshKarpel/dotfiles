#!/usr/bin/env bash
# Play a notification sound, cross-platform (macOS + Linux).
# Usage: claude-sound <stop|notify>

set -euo pipefail

role="${1:-stop}"

# For stop events, only play when stop_hook_active is true (i.e. this is a
# "real" stop after any blocking hooks have already run and cleared). This
# prevents the sound from playing when another Stop hook (e.g. claude-doc-check)
# is about to block the stop.
if [[ "$role" == "stop" ]]; then
  INPUT=$(cat)
  STOP_HOOK_ACTIVE=$(echo "$INPUT" | jq -r '.stop_hook_active // false')
  if [[ "$STOP_HOOK_ACTIVE" != "true" ]]; then
    exit 0
  fi
fi

case "$(uname -s)" in
  Darwin)
    case "$role" in
      stop)   afplay -v 0.40 /System/Library/Sounds/Morse.aiff ;;
      notify) afplay -v 0.35 /System/Library/Sounds/Ping.aiff ;;
    esac
    ;;
  Linux)
    case "$role" in
      stop)   paplay /usr/share/sounds/freedesktop/stereo/complete.oga ;;
      notify) paplay /usr/share/sounds/freedesktop/stereo/message.oga ;;
    esac
    ;;
esac
